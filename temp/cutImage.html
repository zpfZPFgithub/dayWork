<%@ Page Language="C#" AutoEventWireup="true" Inherits="uploadArticleFace" CodeBehind="uploadArticleFace.aspx.cs" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head id="Head1" runat="server">
    <title></title>
    <link href="http://skin.huitu.com/css/main.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="http://skin.huitu.com/css/space/new-hi.css" />
    <style type="text/css">
        body {
            padding: 20px;
            font-size: 12px;
            border: 0px;
        }

        input {
            vertical-align: middle;
            border: 0;
        }

        .none
        {
            display:none;
        } 

        #divUpload {
            margin: -20px 0 0 53px;
            height: 25px;
            vertical-align: middle;
        }

        #divImg {
            position: relative;
            border: 1px solid #ccc;
            margin: 11px 55px 0;
            overflow: auto;
            background-color: #f0f0f0;
            height: 335px;
            width: 400px;
        }

        #optionBar {
            padding: 18px 54px;
        }

        #txtW, #txtH, #txtX, #txtY {
            border: 1px solid gray;
            font-size: 12px;
            line-height: 16px;
            height: 18px;
            text-align: center;
            width: 25px;
            display:none
        }

        #idPicUrl {
            border: 1px solid gray;
            font-size: 12px;
            line-height: 16px;
            height: 18px;
            width: 400px;
            color: Gray;
            background-color: #f0f0f0;
        }

        #tbFile {
            border: 1px solid gray;
            font-size: 12px;
            line-height: 18px;
            height: 22px;
            width: 195px;
        }

        #btnOpacity, #btnColor, #btnScale, #btnMin, #btnSHView, #btnZoomIn, #btnZoomOut, #btnUpload, #btnLoad, #btnRefresh, .btnRate {
            background-color: #f0f0f0;
            border: 1px solid gray;
            font-size: 12px;
            line-height: 18px;
            height: 22px;
            background-image: url(http://skin.huitu.com/images/topbg_c.gif);
            background-position: bottom;
            vertical-align: middle;
        }

        #rRightDown, #rLeftDown, #rLeftUp, #rRightUp, #rRight, #rLeft, #rUp, #rDown {
            position: absolute;
            background: #FFF;
            border: 1px solid #333;
            width: 6px;
            height: 6px;
            z-index: 500;
            font-size: 0;
            opacity: 0.5;
            filter: alpha(opacity=50);
        }

        #rLeftDown, #rRightUp {
            cursor: ne-resize;
        }

        #rRightDown, #rLeftUp {
            cursor: nw-resize;
        }

        #rRight, #rLeft {
            cursor: e-resize;
        }

        #rUp, #rDown {
            cursor: n-resize;
        }

        #rLeftDown {
            left: -4px;
            bottom: -4px;
        }

        #rRightUp {
            right: -4px;
            top: -4px;
        }

        #rRightDown {
            right: -4px;
            bottom: -4px;
        }

        #rLeftUp {
            left: -4px;
            top: -4px;
        }

        #rRight {
            right: -4px;
            top: 50%;
            margin-top: -4px;
        }

        #rLeft {
            left: -4px;
            top: 50%;
            margin-top: -4px;
        }

        #rUp {
            top: -4px;
            left: 50%;
            margin-left: -4px;
        }

        #rDown {
            bottom: -4px;
            left: 50%;
            margin-left: -4px;
        }

        #bgDiv {
            position: relative;
            background-color: #f0f0f0;
        }

        #drgDiv {
            border: 1px dashed #fff;
            width: 200px;
            height: 200px;
            top: 0;
            left: 0;
            cursor: move;
        }

        #viewDiv {
            position: absolute;
            z-index: 10000;
            top: 45px;
            right: 270px;
            cursor: move;
        }

        .opt em {
            margin-top: 15px;
            display: inline-block;
            font-style: normal;
        }
    </style>
    <style type="text/css">
        *.carpe_horizontal_slider_display_combo {
            clear: left;
            margin: 0;
        }

        *.carpe_horizontal_slider_track {
            background-color: #bbb;
            color: #333;
            width: 200px;
            float: left;
            margin: 0;
            line-height: 0px;
            font-size: 0px;
            text-align: left;
            padding: 4px;
            border: 1px solid;
            border-color: #ddd #999 #999 #ddd;
        }

            *.carpe_horizontal_slider_track *.carpe_slider_slit {
                background-color: #333;
                color: #ccc;
                width: 198px;
                height: 2px;
                margin: 4px 0;
                line-height: 0px;
                position: absolute;
                z-index: 1;
                border: 1px solid;
                border-color: #999 #ddd #ddd #999;
            }

            *.carpe_horizontal_slider_track *.carpe_slider {
                width: 16px;
                background-color: #666;
                color: #333;
                position: relative;
                margin: 0;
                height: 8px;
                z-index: 1;
                line-height: 0px;
                font-size: 0px;
                text-align: left;
                border: 2px solid;
                border-color: #999 #333 #333 #999;
            }

        *.carpe_slider_display_holder {
            background-color: #bbb;
            color: #333;
            width: 34px;
            margin: 0;
            float: left;
            padding: 0 2px 0 0;
            height: 20px;
            text-align: right;
            border: 1px solid;
            border-color: #ddd #999 #999 #ddd;
        }

        .carpe_slider_display {
            background-color: #bbb;
            color: #333;
            padding: 3px 1px 0 0;
            width: 28px;
            text-align: right;
            font-size: 11px;
            line-height: 13px;
            font-family: verdana, arial, helvetica, sans-serif;
            font-weight: bold;
            border: 0;
            cursor: default;
        }

        .coverTipIcon {
            width: 12px;
            height: 13px;
            background-position: -450px -209px;
            display: inline-block;
            margin: 6px 0 0 18px;
            float: left;
            display: inline;
        }

        .carousel li {
            float: left;
            display: inline;
            width: 80px;
            height: 80px;
            margin-right: 7px;
            margin-left: 7px;
            cursor: pointer;
        }

        .carousel {
            margin-top:12px;
            margin-left: 42px;
            height: 100px;
        }

        .prev {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: pink;
            cursor:pointer;
        }

        .next {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: pink;
            cursor:pointer;
        }
    </style>
    <script type="text/javascript" src="http://skin.huitu.com/js/jquery-1.8.3.min.js"></script>
    <script src="http://skin.huitu.com/js/common.js" type="text/javascript"></script>
    <script src="http://skin.huitu.com/js/dragdiv.js" type="text/javascript"></script>
    <script src="http://skin.huitu.com/js/jcarousellite_1.0.1.js" type="text/javascript"></script>
    <script type="text/javascript">
        var jq = $.noConflict();
        jq(function () {
            var liHtml = "";
            var imgArr = parent.fckImgSrc;
            if (imgArr.length > 0) {
                for (var i = 0; i < imgArr.length; i++) {
                    liHtml = liHtml + '<li><img width="80" height="80" src="' + imgArr[i] + '" /></li>';
                }
            }
            jq(".carousel").find("ul").html(liHtml);

            jq(".carousel").jCarouselLite({
                btnNext: ".next",
                btnPrev: ".prev",
                visible: 7,      //显示图片数量
                speed: 300,     //滚动完成时长 单位毫秒
                scroll: 1        //每次滚动图片数量
            });
            jq(".carousel img").live("click", function () {
                ChangePic(jq(this).attr("src"));
                jq("#articlePicUrl").attr("value", jq(this).attr("src"));
            });

            jq(".coverCancel").click(function () {
                parent.closeFloatbox();
            });

            if (!jq(".coverchoice1", parent.document).is(":hidden") && jq(".coverchoice1", parent.document).find("img").attr("src") != "") {
                var originalImg = jq(".coverchoice1", parent.document).find("img").attr("src");
                ChangePic(originalImg);
                jq("#originalImg").attr("value", originalImg);

            }

        });

    </script>
    <script type="text/javascript">
        document.domain = "huitu.com";

        function UploadCheck() {
            var uppic = document.getElementById("tbFile").value;
            if (uppic.length == 0) {
                return false;
            }
            return true;
        }

        function ChangeCheck() {
            if (jq("#display1").val() <= 200 / ic._tempImg.height || jq("#display1").val() <= 200 / ic._tempImg.width) {
                200 / ic._tempImg.width > 200 / ic._tempImg.height ? jq("#display1").val(200 / ic._tempImg.width) : jq("#display1").val(200 / ic._tempImg.height);
            }
            if (!confirm("确定修改？")) return false;
            ic.Init();
            
            //var src = document.getElementById("idPicUrl").value;
            //parent.CloseUpload(src);  
            return true;
        }
    </script>
    <script type="text/javascript">
        var isIE = (document.all) ? true : false;

        var isIE6 = isIE && ([/MSIE (\d)\.0/i.exec(navigator.userAgent)][0][1] == 6);

        var $ = function (objectId) {
            if ("string" == typeof objectId) {
                if (document.getElementById && document.getElementById(objectId)) {
                    return document.getElementById(objectId);
                } else if (document.all && document.all(objectId)) {
                    return document.all(objectId);
                } else if (document.layers && document.layers[objectId]) {
                    return document.layers[objectId];
                } else {
                    return false;
                }
            }
            else
                return objectId;
        };

        var Class = {
            create: function () {
                return function () { this.initialize.apply(this, arguments); }
            }
        }

        var Extend = function (destination, source) {
            for (var property in source) {
                destination[property] = source[property];
            }
        }

        var Bind = function (object, fun) {
            return function () {
                return fun.apply(object, arguments);
            }
        }

        var BindAsEventListener = function (object, fun) {
            var args = Array.prototype.slice.call(arguments).slice(2);
            return function (event) {
                return fun.apply(object, [event || window.event].concat(args));
            }
        }

        var CurrentStyle = function (element) {
            return element.currentStyle || document.defaultView.getComputedStyle(element, null);
        }

        function addEventHandler(oTarget, sEventType, fnHandler) {
            if (oTarget.addEventListener) {
                oTarget.addEventListener(sEventType, fnHandler, false);
            } else if (oTarget.attachEvent) {
                oTarget.attachEvent("on" + sEventType, fnHandler);
            } else {
                oTarget["on" + sEventType] = fnHandler;
            }
        };

        function removeEventHandler(oTarget, sEventType, fnHandler) {
            if (oTarget.removeEventListener) {
                oTarget.removeEventListener(sEventType, fnHandler, false);
            } else if (oTarget.detachEvent) {
                oTarget.detachEvent("on" + sEventType, fnHandler);
            } else {
                oTarget["on" + sEventType] = null;
            }
        };
    </script>
    <script type="text/javascript">
        /***拖放代码***/
        var Drag = Class.create();
        Drag.prototype = {
            //拖放对象
            initialize: function (drag, options) {
                this.Drag = $(drag); //拖放对象
                this._x = this._y = 0; //记录鼠标相对拖放对象的位置
                this._marginLeft = this._marginTop = 0; //记录margin
                //事件对象(用于绑定移除事件)
                this._fM = BindAsEventListener(this, this.Move);
                this._fS = Bind(this, this.Stop);

                this.SetOptions(options);

                this.Limit = !!this.options.Limit;
                this.mxLeft = parseInt(this.options.mxLeft);
                this.mxRight = parseInt(this.options.mxRight);
                this.mxTop = parseInt(this.options.mxTop);
                this.mxBottom = parseInt(this.options.mxBottom);

                this.LockX = !!this.options.LockX;
                this.LockY = !!this.options.LockY;
                this.Lock = !!this.options.Lock;

                this.onStart = this.options.onStart;
                this.onMove = this.options.onMove;
                this.onStop = this.options.onStop;

                this._Handle = $(this.options.Handle) || this.Drag;
                this._mxContainer = $(this.options.mxContainer) || null;

                this.Drag.style.position = "absolute";
                //透明
                if (isIE && !!this.options.Transparent) {
                    //填充拖放对象
                    with (this._Handle.appendChild(document.createElement("div")).style) {
                        width = height = "100%"; backgroundColor = "#fff"; filter = "alpha(opacity:0)"; fontSize = 0;
                    }
                }
                //修正范围
                this.Repair();
                addEventHandler(this._Handle, "mousedown", BindAsEventListener(this, this.Start));
            },
            //设置默认属性
            SetOptions: function (options) {
                this.options = {//默认值
                    Handle: "", //设置触发对象（不设置则使用拖放对象）
                    Limit: false, //是否设置范围限制(为true时下面参数有用,可以是负数)
                    mxLeft: 0, //左边限制
                    mxRight: 9999, //右边限制
                    mxTop: 0, //上边限制
                    mxBottom: 9999, //下边限制
                    mxContainer: "", //指定限制在容器内
                    LockX: false, //是否锁定水平方向拖放
                    LockY: false, //是否锁定垂直方向拖放
                    Lock: false, //是否锁定
                    Transparent: false, //是否透明
                    onStart: function () { }, //开始移动时执行
                    onMove: function () { }, //移动时执行
                    onStop: function () { } //结束移动时执行
                };
                Extend(this.options, options || {});
            },
            //准备拖动
            Start: function (oEvent) {
                if (this.Lock) { return; }
                this.Repair();
                //记录鼠标相对拖放对象的位置
                this._x = oEvent.clientX - this.Drag.offsetLeft;
                this._y = oEvent.clientY - this.Drag.offsetTop;
                //记录margin
                this._marginLeft = parseInt(CurrentStyle(this.Drag).marginLeft) || 0;
                this._marginTop = parseInt(CurrentStyle(this.Drag).marginTop) || 0;
                //mousemove时移动 mouseup时停止
                addEventHandler(document, "mousemove", this._fM);
                addEventHandler(document, "mouseup", this._fS);
                if (isIE) {
                    //焦点丢失
                    addEventHandler(this._Handle, "losecapture", this._fS);
                    //设置鼠标捕获
                    this._Handle.setCapture();
                } else {
                    //焦点丢失
                    addEventHandler(window, "blur", this._fS);
                    //阻止默认动作
                    oEvent.preventDefault();
                };
                //附加程序
                this.onStart();
            },
            //修正范围
            Repair: function () {
                if (this.Limit) {
                    //修正错误范围参数
                    this.mxRight = Math.max(this.mxRight, this.mxLeft + this.Drag.offsetWidth);
                    this.mxBottom = Math.max(this.mxBottom, this.mxTop + this.Drag.offsetHeight);
                    //如果有容器必须设置position为relative或absolute来相对或绝对定位，并在获取offset之前设置
                    !this._mxContainer || CurrentStyle(this._mxContainer).position == "relative" || CurrentStyle(this._mxContainer).position == "absolute" ||
(this._mxContainer.style.position = "relative");
                }
            },
            //拖动
            Move: function (oEvent) {
                //判断是否锁定
                if (this.Lock) { this.Stop(); return; };
                //清除选择
                window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty();
                //设置移动参数
                var iLeft = oEvent.clientX - this._x, iTop = oEvent.clientY - this._y;
                //设置范围限制
                if (this.Limit) {
                    //设置范围参数
                    var mxLeft = this.mxLeft, mxRight = this.mxRight, mxTop = this.mxTop, mxBottom = this.mxBottom;
                    //如果设置了容器，再修正范围参数
                    if (!!this._mxContainer) {
                        mxLeft = Math.max(mxLeft, 0);
                        mxTop = Math.max(mxTop, 0);
                        mxRight = Math.min(mxRight, this._mxContainer.clientWidth);
                        mxBottom = Math.min(mxBottom, this._mxContainer.clientHeight);
                    };
                    //修正移动参数
                    iLeft = Math.max(Math.min(iLeft, mxRight - this.Drag.offsetWidth), mxLeft);
                    iTop = Math.max(Math.min(iTop, mxBottom - this.Drag.offsetHeight), mxTop);
                }
                //设置位置，并修正margin
                if (!this.LockX) { this.Drag.style.left = iLeft - this._marginLeft + "px"; }
                if (!this.LockY) { this.Drag.style.top = iTop - this._marginTop + "px"; }
                //附加程序
                this.onMove();
            },
            //停止拖动
            Stop: function () {
                //移除事件
                removeEventHandler(document, "mousemove", this._fM);
                removeEventHandler(document, "mouseup", this._fS);
                if (isIE) {
                    removeEventHandler(this._Handle, "losecapture", this._fS);
                    this._Handle.releaseCapture();
                } else {
                    removeEventHandler(window, "blur", this._fS);
                };
                //附加程序
                this.onStop();
            }
        };
    </script>
    <script type="text/javascript">
        /***缩放代码***/
        var Resize = Class.create();
        Resize.prototype = {
            //缩放对象
            initialize: function (obj, options) {
                this._obj = $(obj); //缩放对象

                this._styleWidth = this._styleHeight = this._styleLeft = this._styleTop = 0; //样式参数
                this._sideRight = this._sideDown = this._sideLeft = this._sideUp = 0; //坐标参数
                this._fixLeft = this._fixTop = 0; //定位参数
                this._scaleLeft = this._scaleTop = 0; //定位坐标

                this._mxSet = function () { }; //范围设置程序
                this._mxRightWidth = this._mxDownHeight = this._mxUpHeight = this._mxLeftWidth = 0; //范围参数
                this._mxScaleWidth = this._mxScaleHeight = 0; //比例范围参数

                this._fun = function () { }; //缩放执行程序

                //获取边框宽度
                var _style = CurrentStyle(this._obj);
                this._borderX = (parseInt(_style.borderLeftWidth) || 0) + (parseInt(_style.borderRightWidth) || 0);
                this._borderY = (parseInt(_style.borderTopWidth) || 0) + (parseInt(_style.borderBottomWidth) || 0);
                //事件对象(用于绑定移除事件)
                this._fR = BindAsEventListener(this, this.Resize);
                this._fS = Bind(this, this.Stop);

                this.SetOptions(options);
                //范围限制
                this.Max = !!this.options.Max;
                this._mxContainer = $(this.options.mxContainer) || null;
                this.mxLeft = Math.round(this.options.mxLeft);
                this.mxRight = Math.round(this.options.mxRight);
                this.mxTop = Math.round(this.options.mxTop);
                this.mxBottom = Math.round(this.options.mxBottom);
                //宽高限制
                this.Min = !!this.options.Min;
                this.minWidth = Math.round(this.options.minWidth);
                this.minHeight = Math.round(this.options.minHeight);
                //按比例缩放
                this.Scale = !!this.options.Scale;
                this.Ratio = Math.max(this.options.Ratio, 0);

                this.onResize = this.options.onResize;

                this._obj.style.position = "absolute";
                !this._mxContainer || CurrentStyle(this._mxContainer).position == "relative" || (this._mxContainer.style.position = "relative");
            },
            //设置默认属性
            SetOptions: function (options) {
                this.options = {//默认值
                    Max: false, //是否设置范围限制(为true时下面mx参数有用)
                    mxContainer: "", //指定限制在容器内
                    mxLeft: 0, //左边限制
                    mxRight: 9999, //右边限制
                    mxTop: 0, //上边限制
                    mxBottom: 9999, //下边限制
                    Min: false, //是否最小宽高限制(为true时下面min参数有用)
                    minWidth: 50, //最小宽度
                    minHeight: 50, //最小高度
                    Scale: false, //是否按比例缩放
                    Ratio: 0, //缩放比例(宽/高)
                    onResize: function () { } //缩放时执行
                };
                Extend(this.options, options || {});
            },
            //设置触发对象
            Set: function (resize, side) {
                var resize = $(resize), fun;
                if (!resize) return;
                //根据方向设置
                switch (side.toLowerCase()) {
                    case "up":
                        fun = this.Up;
                        break;
                    case "down":
                        fun = this.Down;
                        break;
                    case "left":
                        fun = this.Left;
                        break;
                    case "right":
                        fun = this.Right;
                        break;
                    case "left-up":
                        fun = this.LeftUp;
                        break;
                    case "right-up":
                        fun = this.RightUp;
                        break;
                    case "left-down":
                        fun = this.LeftDown;
                        break;
                    case "right-down":
                    default:
                        fun = this.RightDown;
                };
                //设置触发对象
                addEventHandler(resize, "mousedown", BindAsEventListener(this, this.Start, fun));
            },
            //准备缩放
            Start: function (e, fun, touch) {
                //防止冒泡(跟拖放配合时设置)
                e.stopPropagation ? e.stopPropagation() : (e.cancelBubble = true);
                //设置执行程序
                this._fun = fun;
                //样式参数值
                this._styleWidth = this._obj.clientWidth;
                this._styleHeight = this._obj.clientHeight;
                this._styleLeft = this._obj.offsetLeft;
                this._styleTop = this._obj.offsetTop;
                //四条边定位坐标
                this._sideLeft = e.clientX - this._styleWidth;
                this._sideRight = e.clientX + this._styleWidth;
                this._sideUp = e.clientY - this._styleHeight;
                this._sideDown = e.clientY + this._styleHeight;
                //top和left定位参数
                this._fixLeft = this._styleLeft + this._styleWidth;
                this._fixTop = this._styleTop + this._styleHeight;
                //缩放比例
                if (this.Scale) {
                    //设置比例
                    this.Ratio = Math.max(this.Ratio, 0) || this._styleWidth / this._styleHeight;
                    //left和top的定位坐标
                    this._scaleLeft = this._styleLeft + this._styleWidth / 2;
                    this._scaleTop = this._styleTop + this._styleHeight / 2;
                };
                //范围限制
                if (this.Max) {
                    //设置范围参数
                    var mxLeft = this.mxLeft, mxRight = this.mxRight, mxTop = this.mxTop, mxBottom = this.mxBottom;
                    //如果设置了容器，再修正范围参数
                    if (!!this._mxContainer) {
                        mxLeft = Math.max(mxLeft, 0);
                        mxTop = Math.max(mxTop, 0);
                        mxRight = Math.min(mxRight, this._mxContainer.clientWidth);
                        mxBottom = Math.min(mxBottom, this._mxContainer.clientHeight);
                    };
                    //根据最小值再修正
                    mxRight = Math.max(mxRight, mxLeft + (this.Min ? this.minWidth : 0) + this._borderX);
                    mxBottom = Math.max(mxBottom, mxTop + (this.Min ? this.minHeight : 0) + this._borderY);
                    //由于转向时要重新设置所以写成function形式
                    this._mxSet = function () {
                        this._mxRightWidth = mxRight - this._styleLeft - this._borderX;
                        this._mxDownHeight = mxBottom - this._styleTop - this._borderY;
                        this._mxUpHeight = Math.max(this._fixTop - mxTop, this.Min ? this.minHeight : 0);
                        this._mxLeftWidth = Math.max(this._fixLeft - mxLeft, this.Min ? this.minWidth : 0);
                    };
                    this._mxSet();
                    //有缩放比例下的范围限制
                    if (this.Scale) {
                        this._mxScaleWidth = Math.min(this._scaleLeft - mxLeft, mxRight - this._scaleLeft - this._borderX) * 2;
                        this._mxScaleHeight = Math.min(this._scaleTop - mxTop, mxBottom - this._scaleTop - this._borderY) * 2;
                    };
                };
                //mousemove时缩放 mouseup时停止
                addEventHandler(document, "mousemove", this._fR);
                addEventHandler(document, "mouseup", this._fS);
                if (isIE) {
                    addEventHandler(this._obj, "losecapture", this._fS);
                    this._obj.setCapture();
                } else {
                    addEventHandler(window, "blur", this._fS);
                    e.preventDefault();
                };
            },
            //缩放
            Resize: function (e) {
                //清除选择
                window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty();
                //执行缩放程序
                this._fun(e);
                //设置样式，变量必须大于等于0否则ie出错
                with (this._obj.style) {
                    width = this._styleWidth + "px"; height = this._styleHeight + "px";
                    top = this._styleTop + "px"; left = this._styleLeft + "px";
                }
                //附加程序
                this.onResize();
            },
            //缩放程序
            //上
            Up: function (e) {
                this.RepairY(this._sideDown - e.clientY, this._mxUpHeight);
                this.RepairTop();
                this.TurnDown(this.Down);
            },
            //下
            Down: function (e) {
                this.RepairY(e.clientY - this._sideUp, this._mxDownHeight);
                this.TurnUp(this.Up);
            },
            //右
            Right: function (e) {
                this.RepairX(e.clientX - this._sideLeft, this._mxRightWidth);
                this.TurnLeft(this.Left);
            },
            //左
            Left: function (e) {
                this.RepairX(this._sideRight - e.clientX, this._mxLeftWidth);
                this.RepairLeft();
                this.TurnRight(this.Right);
            },
            //右下
            RightDown: function (e) {
                this.RepairAngle(
		e.clientX - this._sideLeft, this._mxRightWidth,
		e.clientY - this._sideUp, this._mxDownHeight
	);
                this.TurnLeft(this.LeftDown) || this.Scale || this.TurnUp(this.RightUp);
            },
            //右上
            RightUp: function (e) {
                this.RepairAngle(
		e.clientX - this._sideLeft, this._mxRightWidth,
		this._sideDown - e.clientY, this._mxUpHeight
	);
                this.RepairTop();
                this.TurnLeft(this.LeftUp) || this.Scale || this.TurnDown(this.RightDown);
            },
            //左下
            LeftDown: function (e) {
                this.RepairAngle(
		this._sideRight - e.clientX, this._mxLeftWidth,
		e.clientY - this._sideUp, this._mxDownHeight
	);
                this.RepairLeft();
                this.TurnRight(this.RightDown) || this.Scale || this.TurnUp(this.LeftUp);
            },
            //左上
            LeftUp: function (e) {
                this.RepairAngle(
		this._sideRight - e.clientX, this._mxLeftWidth,
		this._sideDown - e.clientY, this._mxUpHeight
	);
                this.RepairTop(); this.RepairLeft();
                this.TurnRight(this.RightUp) || this.Scale || this.TurnDown(this.LeftDown);
            },
            //修正程序
            //水平方向
            RepairX: function (iWidth, mxWidth) {
                iWidth = this.RepairWidth(iWidth, mxWidth);
                if (this.Scale) {
                    var iHeight = this.RepairScaleHeight(iWidth);
                    if (this.Max && iHeight > this._mxScaleHeight) {
                        iHeight = this._mxScaleHeight;
                        iWidth = this.RepairScaleWidth(iHeight);
                    } else if (this.Min && iHeight < this.minHeight) {
                        var tWidth = this.RepairScaleWidth(this.minHeight);
                        if (tWidth < mxWidth) { iHeight = this.minHeight; iWidth = tWidth; }
                    }
                    this._styleHeight = iHeight;
                    this._styleTop = this._scaleTop - iHeight / 2;
                }
                this._styleWidth = iWidth;
            },
            //垂直方向
            RepairY: function (iHeight, mxHeight) {
                iHeight = this.RepairHeight(iHeight, mxHeight);
                if (this.Scale) {
                    var iWidth = this.RepairScaleWidth(iHeight);
                    if (this.Max && iWidth > this._mxScaleWidth) {
                        iWidth = this._mxScaleWidth;
                        iHeight = this.RepairScaleHeight(iWidth);
                    } else if (this.Min && iWidth < this.minWidth) {
                        var tHeight = this.RepairScaleHeight(this.minWidth);
                        if (tHeight < mxHeight) { iWidth = this.minWidth; iHeight = tHeight; }
                    }
                    this._styleWidth = iWidth;
                    this._styleLeft = this._scaleLeft - iWidth / 2;
                }
                this._styleHeight = iHeight;
            },
            //对角方向
            RepairAngle: function (iWidth, mxWidth, iHeight, mxHeight) {
                iWidth = this.RepairWidth(iWidth, mxWidth);
                if (this.Scale) {
                    iHeight = this.RepairScaleHeight(iWidth);
                    if (this.Max && iHeight > mxHeight) {
                        iHeight = mxHeight;
                        iWidth = this.RepairScaleWidth(iHeight);
                    } else if (this.Min && iHeight < this.minHeight) {
                        var tWidth = this.RepairScaleWidth(this.minHeight);
                        if (tWidth < mxWidth) { iHeight = this.minHeight; iWidth = tWidth; }
                    }
                } else {
                    iHeight = this.RepairHeight(iHeight, mxHeight);
                }
                this._styleWidth = iWidth;
                this._styleHeight = iHeight;
            },
            //top
            RepairTop: function () {
                this._styleTop = this._fixTop - this._styleHeight;
            },
            //left
            RepairLeft: function () {
                this._styleLeft = this._fixLeft - this._styleWidth;
            },
            //height
            RepairHeight: function (iHeight, mxHeight) {
                iHeight = Math.min(this.Max ? mxHeight : iHeight, iHeight);
                iHeight = Math.max(this.Min ? this.minHeight : iHeight, iHeight, 0);
                return iHeight;
            },
            //width
            RepairWidth: function (iWidth, mxWidth) {
                iWidth = Math.min(this.Max ? mxWidth : iWidth, iWidth);
                iWidth = Math.max(this.Min ? this.minWidth : iWidth, iWidth, 0);
                return iWidth;
            },
            //比例高度
            RepairScaleHeight: function (iWidth) {
                return Math.max(Math.round((iWidth + this._borderX) / this.Ratio - this._borderY), 0);
            },
            //比例宽度
            RepairScaleWidth: function (iHeight) {
                return Math.max(Math.round((iHeight + this._borderY) * this.Ratio - this._borderX), 0);
            },
            //转向程序
            //转右
            TurnRight: function (fun) {
                if (!(this.Min || this._styleWidth)) {
                    this._fun = fun;
                    this._sideLeft = this._sideRight;
                    this.Max && this._mxSet();
                    return true;
                }
            },
            //转左
            TurnLeft: function (fun) {
                if (!(this.Min || this._styleWidth)) {
                    this._fun = fun;
                    this._sideRight = this._sideLeft;
                    this._fixLeft = this._styleLeft;
                    this.Max && this._mxSet();
                    return true;
                }
            },
            //转上
            TurnUp: function (fun) {
                if (!(this.Min || this._styleHeight)) {
                    this._fun = fun;
                    this._sideDown = this._sideUp;
                    this._fixTop = this._styleTop;
                    this.Max && this._mxSet();
                    return true;
                }
            },
            //转下
            TurnDown: function (fun) {
                if (!(this.Min || this._styleHeight)) {
                    this._fun = fun;
                    this._sideUp = this._sideDown;
                    this.Max && this._mxSet();
                    return true;
                }
            },
            //停止缩放
            Stop: function () {
                removeEventHandler(document, "mousemove", this._fR);
                removeEventHandler(document, "mouseup", this._fS);
                if (isIE) {
                    removeEventHandler(this._obj, "losecapture", this._fS);
                    this._obj.releaseCapture();
                } else {
                    removeEventHandler(window, "blur", this._fS);
                }
            }
        };
    </script>
    <script type="text/javascript">
        /***图片切割***/
        var ImgCropper = Class.create();
        ImgCropper.prototype = {
            //容器对象,控制层,图片地址
            initialize: function (container, handle, url, options) {
                this._Container = $(container); //容器对象
                this._layHandle = $(handle); //控制层
                this.Url = url; //图片地址
                this._layBase = this._Container.appendChild(document.createElement("img")); //底层
                this._layCropper = this._Container.appendChild(document.createElement("img")); //切割层
                this._layCropper.onload = Bind(this, this.SetPos);
                //用来设置大小
                this._tempImg = document.createElement("img");
                this._tempImg.onload = Bind(this, this.SetSize);
                this.SetOptions(options);

                this.Opacity = Math.round(this.options.Opacity);
                this.Color = this.options.Color;
                this.Scale = !!this.options.Scale;
                this.Ratio = Math.max(this.options.Ratio, 0);
                this.Width = Math.round(this.options.Width);
                this.Height = Math.round(this.options.Height);

                this.OriginalWidth = 0; //原始尺寸
                this.InputW = $(this.options.InputW);
                this.InputH = $(this.options.InputH);
                this.InputX = $(this.options.InputX);
                this.InputY = $(this.options.InputY);


                //设置预览对象
                var oPreview = $(this.options.Preview); //预览对象
                if (oPreview) {
                    //oPreview.style.overflow = "hidden";
                    this.viewWidth = Math.round(this.options.viewWidth);
                    this.viewHeight = Math.round(this.options.viewHeight);
                    //预览图片对象
                    this._view = oPreview.appendChild(document.createElement("img"));
                    this._view.style.position = "absolute";
                    //this._view.setAttribute("onerror", "alert('源图已不存在，请手动上传')");
                    this._view.onload = Bind(this, this.SetPreview);
                }
                //设置拖放
                this._drag = new Drag(this._layHandle, { Limit: true, onMove: Bind(this, this.SetPos), Transparent: true });
                //设置缩放
                this.Resize = !!this.options.Resize;
                if (this.Resize) {
                    var op = this.options, _resize = new Resize(this._layHandle, { Max: true, onResize: Bind(this, this.SetPos) });
                    //设置缩放触发对象
                    op.RightDown && (_resize.Set(op.RightDown, "right-down"));
                    op.LeftDown && (_resize.Set(op.LeftDown, "left-down"));
                    op.RightUp && (_resize.Set(op.RightUp, "right-up"));
                    op.LeftUp && (_resize.Set(op.LeftUp, "left-up"));
                    op.Right && (_resize.Set(op.Right, "right"));
                    op.Left && (_resize.Set(op.Left, "left"));
                    op.Down && (_resize.Set(op.Down, "down"));
                    op.Up && (_resize.Set(op.Up, "up"));
                    //最小范围限制
                    this.Min = !!this.options.Min;
                    this.minWidth = Math.round(this.options.minWidth);
                    this.minHeight = Math.round(this.options.minHeight);
                    //设置缩放对象
                    this._resize = _resize;
                }
                //设置样式
                this._Container.style.position = "relative";
                this._Container.style.overflow = "hidden";
                this._layHandle.style.zIndex = 200;
                this._layCropper.style.zIndex = 100;
                this._layBase.style.position = this._layCropper.style.position = "absolute";
                this._layBase.style.top = this._layBase.style.left = this._layCropper.style.top = this._layCropper.style.left = 0; //对齐

                //初始化设置
                this.Init();
            },
            //设置默认属性
            SetOptions: function (options) {
                this.options = {//默认值
                    Opacity: 50, //透明度(0到100)
                    Color: "", //背景色
                    Width: 0, //图片高度
                    Height: 0, //图片高度
                    //缩放触发对象
                    Resize: false, //是否设置缩放
                    Right: "", //右边缩放对象
                    Left: "", //左边缩放对象
                    Up: "", //上边缩放对象
                    Down: "", //下边缩放对象
                    RightDown: "", //右下缩放对象
                    LeftDown: "", //左下缩放对象
                    RightUp: "", //右上缩放对象
                    LeftUp: "", //左上缩放对象
                    Min: false, //是否最小宽高限制(为true时下面min参数有用)
                    minWidth: 50, //最小宽度
                    minHeight: 50, //最小高度
                    Scale: false, //是否按比例缩放viewDiv
                    Ratio: 0, //缩放比例(宽/高)
                    //预览对象设置
                    Preview: "", //预览对象
                    viewWidth: 0, //预览宽度
                    viewHeight: 0, //预览高度
                    InputW: "",
                    InputH: "",
                    InputX: "",
                    InputY: ""
                };
                Extend(this.options, options || {});
            },
            //初始化对象
            Init: function () {
                //设置背景色
                this.Color && (this._Container.style.backgroundColor = this.Color);
                //设置图片
                this._tempImg.src = this._layBase.src = this._layCropper.src = this.Url;
                //设置透明
                if (isIE) {
                    this._layBase.style.filter = "alpha(opacity:" + this.Opacity + ")";
                } else {
                    this._layBase.style.opacity = this.Opacity / 100;
                }
                //设置预览对象
                this._view && (this._view.src = this.Url);
                //设置缩放
                if (this.Resize) {
                    with (this._resize) {
                        Scale = this.Scale; Ratio = this.Ratio; Min = this.Min; minWidth = this.minWidth; minHeight = this.minHeight;
                    }
                }
            },
            //设置切割样式
            SetPos: function () {
                //ie6渲染bug
                if (isIE6) { with (this._layHandle.style) { zoom = .9; zoom = 1; }; };
                //获取位置参数
                var p = this.GetPos();
                //按拖放对象的参数进行切割
                this._layCropper.style.clip = "rect(" + p.Top + "px " + (p.Left + p.Width - 2) + "px " + (p.Top + p.Height - 2) + "px " + p.Left + "px)";
                //设置预览
                this.SetPreview();

                if (p.Width < 199.9) p.Width = 200;
                if (p.Height < 199.9) p.Height = 200;

                //Display input value
                this.InputW.value = p.Width;
                this.InputH.value = p.Height;
                this.InputX.value = p.Left;
                this.InputY.value = p.Top;

            },
            //设置预览效果
            SetPreview: function () {
                if (this._view) {
                    //预览显示的宽和高
                    var p = this.GetPos(), s = this.GetSize(p.Width, p.Height, this.viewWidth, this.viewHeight), scale = s.Height / p.Height;
                    //按比例设置参数
                    var pHeight = this._layBase.height * scale, pWidth = this._layBase.width * scale, pTop = p.Top * scale, pLeft = p.Left * scale;
                    if ((pWidth - pLeft) < 199.99 || pHeight - pTop < 199.99) {
                        $("drgDiv").style.left = "0";
                        $("drgDiv").style.top = "0";
                    }

                    //设置预览对象
                    with (this._view.style) {
                        //设置样式
                        width = pWidth + "px"; height = pHeight + "px"; top = -pTop + "px "; left = -pLeft + "px";
                        //切割预览图
                        clip = "rect(" + pTop + "px " + (pLeft + s.Width) + "px " + (pTop + s.Height) + "px " + pLeft + "px)";
                    }
                }
            },
            //设置图片大小
            SetSize: function () {
                var s = this.GetSize(this._tempImg.width, this._tempImg.height, this.Width, this.Height);
                //设置底图和切割图
                if (s.Width < 200) {
                    s.Width = 200;
                    $("drgDiv").style.left = "0";
                    $("drgDiv").style.top = "0";
                }
                if (s.Height < 200) {
                    s.Height = 200;
                    $("drgDiv").style.left = "0";
                    $("drgDiv").style.top = "0";
                }
                this._layBase.style.width = this._layCropper.style.width = s.Width + "px";
                this._layBase.style.height = this._layCropper.style.height = s.Height + "px";
                //设置拖放范围
                this._drag.mxRight = s.Width; this._drag.mxBottom = s.Height;
                //设置缩放范围
                if (this.Resize) { this._resize.mxRight = s.Width; this._resize.mxBottom = s.Height; }

                //Set Container Scale
                this._Container.style.width = this._layBase.style.width;
                this._Container.style.height = this._layBase.style.height;
                if (this.OriginalWidth == 0) this.OriginalWidth = parseInt(this._layBase.style.width.replace("px", ""));
            },
            //获取当前样式
            GetPos: function () {
                with (this._layHandle) {
                    return { Top: offsetTop, Left: offsetLeft, Width: offsetWidth, Height: offsetHeight }
                }
            },
            //获取尺寸
            GetSize: function (nowWidth, nowHeight, fixWidth, fixHeight) {
                var iWidth = nowWidth, iHeight = nowHeight, scale = iWidth / iHeight;
                //按比例设置
                if (fixHeight) { iWidth = (iHeight = fixHeight) * scale; }
                if (fixWidth && (!fixHeight || iWidth > fixWidth)) { iHeight = (iWidth = fixWidth) / scale; }
                //返回尺寸对象
                return { Width: iWidth, Height: iHeight }
            }
        };
    </script>
    <script type="text/javascript">
    <!--
    /***滑杆脚本***/
    Number.prototype.NaN0 = function () { return isNaN(this) ? 0 : this; }
    function getMouseOffset(target, ev) {
        ev = ev || window.event;

        var docPos = getPosition(target);
        var mousePos = mouseCoords(ev);
        return { x: mousePos.x - docPos.x, y: mousePos.y - docPos.y };
    }

    function getPosition(e) {
        var left = 0;
        var top = 0;
        while (e.offsetParent) {
            left += e.offsetLeft + (e.currentStyle ? (parseInt(e.currentStyle.borderLeftWidth)).NaN0() : 0);
            top += e.offsetTop + (e.currentStyle ? (parseInt(e.currentStyle.borderTopWidth)).NaN0() : 0);
            e = e.offsetParent;
        }

        left += e.offsetLeft + (e.currentStyle ? (parseInt(e.currentStyle.borderLeftWidth)).NaN0() : 0);
        top += e.offsetTop + (e.currentStyle ? (parseInt(e.currentStyle.borderTopWidth)).NaN0() : 0);

        return { x: left, y: top };

    }

    function mouseCoords(ev) {
        if (ev.pageX || ev.pageY) {
            return { x: ev.pageX, y: ev.pageY };
        }
        return {
            x: ev.clientX + document.body.scrollLeft - document.body.clientLeft,
            y: ev.clientY + document.body.scrollTop - document.body.clientTop
        };
    }
    //为元素添加事件
    function AddObjectEvent(targetObj, eventName, eventFunc) {
        if (typeof targetObj == "string")
            targetObj = $(targetObj);
        if (targetObj) {
            if (targetObj.attachEvent) {
                targetObj.attachEvent(eventName, eventFunc);
            }
            else if (targetObj.addEventListener) {
                eventName = eventName.toString().replace(/on(.*)/i, '$1');
                targetObj.addEventListener(eventName, eventFunc, true);
            }
        }
    }
    function MakeSlider(track, slider, iniPos, OnMoveFunc, OnUpFunc) {
        if (typeof track == "string")
            track = $(track);
        if (typeof slider == "string")
            slider = $(slider);
        if (!slider || !track) return;


        var preLocation = iniPos;
        var MethodOnMove = OnMoveFunc ? OnMoveFunc : function () { };
        var MethodOnUp = OnUpFunc ? OnUpFunc : function () { };

        var iMouseDown = false;
        var sliderObj = null;
        var trackObj = null;
        var preMousePos = null;
        var slideRange = { min: null, max: null };
        var prePosition = getPosition(slider);

        slideRange.min = getPosition(track).x;
        slideRange.max = getPosition(track).x + track.offsetWidth;

        var lengthTrack = track.offsetWidth;
        var lengthSlider = slider.offsetWidth;

        var outInterface = preLocation;

        slider.style.position = "relative";

        var OnLoad = function () {

            slider.style.left = (lengthTrack * preLocation - lengthSlider / 2).toString() + "px";
            ReLocate();
        };

        slider.onmousedown = function (ev) {
            ev = ev || window.event;
            iMouseDown = true;
            sliderObj = this;
            trackObj = track;

            mouseOffset = getMouseOffset(this, ev);
            preMousePos = mouseCoords(ev);
            return false;
        };

        var CheckOut = function (ev) {
            ev = ev || window.event;

            var mousePos = mouseCoords(ev);

            if (mousePos.x <= (slideRange.min + mouseOffset.x))
                return 1;  //左边超界
            if (mousePos.x >= (slideRange.max - (slider.offsetWidth - mouseOffset.x)))
                return 2;  //右边超界
            return 0;      //没有超界
        };
        var OnSliding = function (ev) {
            if (!iMouseDown || !sliderObj) return;

            ev = ev || window.event;
            var mousePos = mouseCoords(ev);

            var out = CheckOut(ev);
            if (0 != out) {

                if (1 == out) {
                    sliderObj.style.left = "0px";
                    outInterface = 0;
                }
                else if (2 == out) {
                    sliderObj.style.left = (lengthTrack - lengthSlider) + "px";
                    outInterface = 1;
                }
                MethodOnMove(outInterface);
                return false;
            }
            if (sliderObj) {

                var reSliderLeft = mousePos.x - slideRange.min - mouseOffset.x;
                sliderObj.style.left = (reSliderLeft) + "px";
                outInterface = reSliderLeft / (lengthTrack - lengthSlider);
                MethodOnMove(outInterface);
            }
            if (trackObj || sliderObj)
                return false;
        };
        var OnSlideEnd = function (ev) {
            if (sliderObj || trackObj) {
                sliderObj = null;
                trackObj = null;
                iMouseDown = false;
                MethodOnUp(outInterface);
            }
        };
        var OnTrackDown = function (ev) {
            var mousePos = mouseCoords(ev);
            slider.style.left = (mousePos.x - slideRange.min - slider.offsetWidth / 2) + "px";
            ReLocate();
            outInterface = parseInt(slider.style.left.match(/(\d)+/)) / (lengthTrack - lengthSlider);
            MethodOnUp(outInterface);
        };
        var ReLocate = function () {
            if (slider.style.left.indexOf("-") >= 0)
                slider.style.left = "0px";
            else if (parseInt(slider.style.left.match(/(\d)+/)) >= (lengthTrack - lengthSlider))
                slider.style.left = (lengthTrack - lengthSlider) + "px";
        };

        this.ResetSlider = function (p) {
            slider.style.left = (lengthTrack * p - lengthSlider / 2).toString() + "px";
            ReLocate();
            MethodOnMove(p);
        };

        AddObjectEvent(document, "onmousemove", OnSliding);
        AddObjectEvent(document, "onmouseup", OnSlideEnd);
        AddObjectEvent(track, "onclick", OnTrackDown);
        AddObjectEvent(window, "onload", OnLoad);
    }
    //-->
    </script>
</head>
<body>
    <form id="form1" runat="server">
        <asp:HiddenField ID="originalImg" runat="server" />
        <input id="articlePicName" type="hidden" value="" runat="server" />
        <input id="hdCount" type="hidden" value="0" />
        <input id="articlePicUrl" value="" type="hidden" runat="server" />
        <input type="text" id="txtW" name="txtW" title="切图宽度" maxlength="3" onfocus="this.select()" />
        <input type="text" id="txtH" name="txtH" title="切图高度" maxlength="3" onfocus="this.select()" />
        <input type="text" id="txtX" name="txtX" title="切图X位移" maxlength="3" onfocus="this.select()" />
        <input type="text" id="txtY" name="txtY" title="切图Y位移" maxlength="3" onfocus="this.select()" />
        <div id="divImg" runat="server">
            <div id="bgDiv">
                <div id="drgDiv">
                </div>
            </div>
        </div>
        <div id="optionBar">
            <div class="carpe_horizontal_slider_display_combo" title="设置图片比例">
                <div class="carpe_slider_display_holder">
                    <input class="carpe_slider_display" id="display1" name="display1" value="1" type="text"
                        readonly="readonly" />
                </div>
                <div class="carpe_horizontal_slider_track">
                    <div class="carpe_slider_slit" id="track">
                        &nbsp;
                    </div>
                    <div class="carpe_slider" id="slider">
                        &nbsp;
                    </div>
                </div>
            </div>


            
        </div>
        <div id="viewDiv">
            <div class="corverImgTip" style="position: absolute; width: 285px; height: 27px; line-height: 27px; background-color: #E1F8FE; top: 260px; left: -32px;">
                <span class="coverTipIcon"></span>&nbsp;&nbsp;请选择<span style="color: red">最短边大于200px</span>的图片作为封面图！
            </div>
        </div>


        <div class="CarouselL" style="position: relative; background: #F6F4F5; border: 1px solid #E3E5E4;margin-top:12px;">
            <span class="prev" style="top: 40px; left: 8px; position: absolute; width: 12px; height: 23px; background-position: -185px -537px;"></span>
            <span class="next" style="top: 40px; right: 13px; position: absolute; width: 12px; height: 23px; background-position: -200px -537px;"></span>
            <div class="carousel">
                <ul>
                </ul>
            </div>
        </div>

        <div style="width: 175px; margin: 24px auto; height: 27px">
            <asp:Button ID="btnOk" class="coverSub"  style="width: 69px; height: 25px; background-position: -311px -587px; float: left;" Text="提&nbsp;交" OnClick="btnChange_Click" OnClientClick="return ChangeCheck()"
                runat="server" />
            <input class="coverCancel" style="width: 79px; height: 27px; background-position: -260px -457px; float: right" type="button" value="取&nbsp;消" />
        </div>


        <script type="text/javascript">

            //初始化图片编辑器
            var imgUrl = $("idPicUrl").value + "?v=" + Math.random();
            var ic = new ImgCropper("bgDiv", "drgDiv", imgUrl, {
                Width: 0, Height: 0,
                Color: "#f0f0f0",
                Resize: true,
                Right: "rRight", Left: "rLeft", Up: "rUp", Down: "rDown",
                //RightDown: "rRightDown", LeftDown: "rLeftDown", RightUp: "rRightUp", LeftUp: "rLeftUp",
                Preview: "viewDiv",
                viewWidth: 200, viewHeight: 200,
                InputW: "txtW",
                InputH: "txtH",
                InputX: "txtX",
                InputY: "txtY"
            })

            //初始化滑杆
            var slider = new MakeSlider('track', 'slider', 1, OnSliderChanged, OnSliderChanged);

            //允许拖放预览窗口
            //    DragDiv("viewDiv");

            //添加按钮事件
            $("txtW").onblur = function () {
                if (!this.value.isAllNumber()) return;
                if (parseInt(this.value) >= 2) {
                    ic._layHandle.style.width = (parseInt(this.value) - 2).toString() + "px";
                    ic.Init();
                }
            }

            $("txtH").onblur = function () {
                if (!this.value.isAllNumber()) return;
                if (parseInt(this.value) >= 2) {
                    ic._layHandle.style.height = (parseInt(this.value) - 2).toString() + "px";
                    ic.Init();
                }
            }

            $("txtX").onblur = function () {
                if (!this.value.isAllNumber()) return;
                ic._layHandle.style.left = this.value + "px";
                ic.Init();
            }

            $("txtY").onblur = function () {
                if (!this.value.isAllNumber()) return;
                ic._layHandle.style.top = this.value + "px";
                ic.Init();
            }

            $("btnZoomIn").onclick = function () {
                if (ic.viewWidth == 0) {
                    var p = ic.GetPos();
                    ic.viewWidth = p.Width;
                }
                ic.viewWidth += 50;
                ic.Init();
            }

            $("btnZoomOut").onclick = function () {
                if (ic.viewWidth > 50) {
                    ic.viewWidth -= 50;
                    ic.Init();
                }
                else if (ic.viewWidth == 0) {
                    var p = ic.GetPos();
                    ic.viewWidth = p.Width;
                    ic.viewWidth -= 50;
                    ic.Init();
                }
            }

            //换图
            function ChangePic(url) {
                if (url.length > 0) {
                    //$("idPicUrl").value = url;
                    ic.Url = url;
                    $("ppic").src = url;

                    //重置滑杆
                    slider.ResetSlider(1);

                    ic.OriginalWidth = 0;
                    ic.Width = 0;
                    ic.Height = 0;
                    ic.Init();
                }
            }

            //缩放图片并输出比例
            function OnSliderChanged(p) {
                ic.Width = ic.OriginalWidth * p;
                //ic最小值小于200
                ic.Init();
                $('display1').value = p;
            }

            //设置常用比例
            function SetRate(v) {
                var val = v.split("×");
                $("txtW").value = val[0];
                $("txtW").onblur();
                $("txtH").value = val[1];
                $("txtH").onblur();
            }
        </script>
    </form>
</body>
</html>
